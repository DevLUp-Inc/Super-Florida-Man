name: Build

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # Build
  build:
    runs-on: ubuntu-latest
    steps:
    # Log Disk Usage
    - run: "df -h"
    # Cleanup Disk Space
    - uses: easimon/maximize-build-space@v4
      with:
        root-reserve-mb: 46080
        swap-size-mb: 1024
        remove-dotnet: "true"
        remove-android: "true"
        remove-haskell: "True"
    # Log Disk Usage
    - run: "df -h"
    # Checkout Super-Florida-Man
    - uses: actions/checkout@v2.3.5
      with:
          lfs: false
    # Docker Login
    - run: "echo ${{ secrets.GH_TOKEN }} | docker login ghcr.io -u ${{ secrets.GH_USERNAME }} --password-stdin"
    # Pull Unreal Engine Image
    - run: "docker pull ghcr.io/epicgames/unreal-engine:dev-4.27"
    # Log Disk Usage
    - run: "df -h"
    # Build Project
    - run: "docker run --rm -ti -v ${{ github.workspace }}:/project ghcr.io/epicgames/unreal-engine:dev-4.27"
    # Log Disk Usage
    - run: "df -h"
    # Log Directories
    - run: "du -a ."
    # Upload
    - uses: actions/upload-artifact@v2.1.4
      with:
        name: Build
        path: project
